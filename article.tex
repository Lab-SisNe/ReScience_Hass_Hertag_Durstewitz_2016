\documentclass[a4paper,11pt]{article}

% ---- Encoding ---------------------------------------------------------------
\usepackage[utf8]{inputenc}

% --- Langage -----------------------------------------------------------------
\usepackage[american]{babel}


% --- Various packages --------------------------------------------------------
\usepackage{ifthen}
\usepackage{tabularx}
\usepackage{tikz}
\usepackage{framed}
%% \usepackage{ccicons}



% --- Mathematics -------------------------------------------------------------
\usepackage{amsmath}

% --- Page layout -------------------------------------------------------------
\usepackage[a4paper]{geometry}
\geometry{left=3.5cm, right=2.5cm, height=28cm}
\geometry{footskip=1.25cm, headheight=1cm, headsep=1.25cm}
\geometry{marginparsep=0.0cm, marginpar=0.0cm}
\geometry{includehead, includefoot, includemp}


% --- Font stack --------------------------------------------------------------
\usepackage{mathpazo}   % Roman & math
\usepackage[scale=0.95]{FiraSans}   % Sans Serif
\usepackage[varqu]{zi4} % Monotype


% --- Colors ------------------------------------------------------------------
\usepackage{xcolor}
\definecolor{darkred}{HTML}{CF232B}
\definecolor{darkblue}{HTML}{2B23CF}
\definecolor{darkgray}{HTML}{555555}
\definecolor{lightgray}{HTML}{F9F9F9}
%\definecolor{citecolor}{HTML}{EB811B}
\colorlet{citecolor}{darkblue}
\colorlet{linkcolor}{citecolor}
\colorlet{urlcolor}{citecolor}


% -- Section titles & ToC -----------------------------------------------------
\usepackage{sectsty}
\allsectionsfont{\sffamily\bfseries}
%\usepackage{tocloft}
%\renewcommand{\thesection}{}
%\renewcommand{\cftsecfont}{\sffamily}
%\renewcommand{\cftsecleader}{\cftdotfill{\cftdotsep}}
%\setcounter{tocdepth}{1}

% With babel
\addto\captionsamerican{
  \renewcommand{\contentsname}
    {\normalsize \sf \bfseries Contents}%
}
% Without babel
% \renewcommand{\contentsname}{}

%\makeatletter
%\def\@seccntformat#1{\csname #1ignore\expandafter\endcsname\csname the#1\endcsname\quad}
%\let\sectionignore\@gobbletwo
%\let\latex@numberline\numberline
%\def\numberline#1{\if\relax#1\relax\else\latex@numberline{#1}\fi}
%\makeatother

% --- Sidenotes ---------------------------------------------------------------
% Used in \sidenote
% Changed to meet the question of user J. Bratt
%  (https://tex.stackexchange.com/questions/361622).
%% \usepackage{sidenotes}
%% \makeatletter
%% \RenewDocumentCommand \sidenotetext { o o +m }
%% {\IfNoValueOrEmptyTF{#1}{
%% \@sidenotes@placemarginal{#2}{\textsuperscript{\sf\thesidenote}{}~\sf\footnotesize#3}
%% \refstepcounter{sidenote}}
%% {\@sidenotes@placemarginal{#2}{\textsuperscript{#1}~#3}}}
%% \makeatother


% --- Captions ----------------------------------------------------------------
\usepackage[labelsep=period]{caption}
\renewcommand{\captionfont}{\small}
\renewcommand{\captionlabelfont}{\small\sffamily\bfseries}
% \captionsetup[figure]{justification=justified, singlelinecheck=false}
% \captionsetup[table]{justification=justified, singlelinecheck=false}


% --- Hyperref & colors -------------------------------------------------------
\usepackage[pdfusetitle,
            bookmarks=true,
            breaklinks=true,
            pdfborder={0 0 0},
            citecolor=citecolor,
            linkcolor=linkcolor,
            urlcolor=urlcolor,
            colorlinks=true,
            linktocpage=false,
            hyperindex=true,
            colorlinks=true,
            linktocpage=false,
            linkbordercolor=white]{hyperref}
\urlstyle{sf}


% --- Listings ----------------------------------------------------------------
\usepackage{listings}
\lstset{%
  basicstyle=\ttfamily\small,
  keywordstyle=\color{black}\bfseries,
  commentstyle=\color{gray},
  stringstyle=\color{blue},
  backgroundcolor=\color{white},
  numbers=none,
  numberstyle=\ttfamily,
  stepnumber=2,
  showspaces=false,
  showstringspaces=false,
  showtabs=false,
  frame=none,
  framerule=0.5pt,
  tabsize=2,
  rulesep=5em,
  captionpos=b,
  breaklines=true,
  breakatwhitespace=false,
  framexleftmargin=0em,
  xleftmargin=0em,
  framexrightmargin=0em,
  xrightmargin=0em,
  aboveskip=0.5em,
  belowskip=0.5em,
}

% --- Bibliography ------------------------------------------------------------
\usepackage[
  backend=biber,
  style = numeric,
  % style=authoryear,
  sorting = none,
  giveninits = true,
  maxcitenames=3,
  mincitenames=1,
  maxbibnames=10,
  isbn = false,
  url = false,
  doi = false,
  autocite = superscript,
  natbib = true]{biblatex}
\usepackage{bibentry}
\DeclareFieldFormat{labelnumberwidth}{#1\adddot}

% Side margin cite 
%% \newcommand{\sidecite}[1]{\citep{#1}\marginpar{\sf\scriptsize\fullcite{#1}}}


% --- Layout ------------------------------------------------------------------
% No indentation at beginning of a new paragraph
\setlength\parindent{0pt}

% No space between items in itemize and enuemrate lists
\usepackage{enumitem}
\setlist[itemize]{noitemsep}
\setlist[enumerate]{noitemsep}


% --- Authors block -----------------------------------------------------------
\usepackage{authblk,etoolbox}

\makeatletter
% patch \maketitle so that it doesn't center
\patchcmd{\@maketitle}{center}{flushleft}{}{}
\patchcmd{\@maketitle}{center}{flushleft}{}{}
% patch \maketitle so that the font size for the title is normal
\patchcmd{\@maketitle}{\LARGE}{\Large\sf\bfseries\vspace{-2.5em}}{}{}

% patch the patch by authblk so that the author block is flush left
\def\maketitle{{%
  \renewenvironment{tabular}[2][]
    {\begin{flushleft}}
    {\end{flushleft}}
  \AB@maketitle}}
\makeatother

\setlength{\affilsep}{0.25em}
\renewcommand\Affilfont{\normalfont\sf\footnotesize}
\renewcommand\Authfont{\sf\bfseries\small}
\renewcommand\Authands{\normalfont\sf\small}


% --- Various convenient macros -----------------------------------------------
\usepackage[many]{tcolorbox}
\newtcbox{\iconbox}[1][]{%
  enhanced,nobeforeafter,tcbox raise base, 
  boxrule=0.4pt, top=0pt, bottom=-1pt,
  right=1pt, left=1pt, arc=1pt, boxsep=1pt,
  fontupper={\tiny \sffamily}, before upper={\vphantom{dlg}},
  colframe=white, colback=black!10!white, coltext=black}
\newcommand{\orcid}[1]{\href{https://orcid.org/#1}{\iconbox{ID}}}
\newcommand{\doi}[1]{\href{http://doi.org/#1}{#1}}
\newcommand{\github}[1]{\href{https://github.com/#1}{github.com/#1}}

% See https://tex.stackexchange.com/questions/99316/symbol-for-external-links
\newcommand{\ExternalLink}{%
    \tikz[x=1.2ex, y=1.2ex, baseline=-0.05ex]{% 
        \begin{scope}[x=1ex, y=1ex]
            \clip (-0.1,-0.1) 
                --++ (-0, 1.2) 
                --++ (0.6, 0) 
                --++ (0, -0.6) 
                --++ (0.6, 0) 
                --++ (0, -1);
            \path[draw, 
                line width = 0.5, 
                rounded corners=0.5] 
                (0,0) rectangle (1,1);
        \end{scope}
        \path[draw, line width = 0.5] (0.5, 0.5) 
            -- (1, 1);
        \path[draw, line width = 0.5] (0.6, 1) 
            -- (1, 1) -- (1, 0.6);
        }
    }



% --- Headers & footers -------------------------------------------------------
\input{article-metadata.tex}
\newcommand{\ReScience}{\sf Re{\bfseries \textcolor{darkred}{Science}} }
\usepackage{fancyhdr}

\pagestyle{fancy}
\fancypagestyle{plain}{}
\addtolength{\headwidth}{\marginparsep}
\addtolength{\headwidth}{\marginparwidth}
\def\fullwidth{\headwidth}
\def\sidewidth{\marginparwidth}
\renewcommand{\headrulewidth}{0.0pt}
\lhead{\sf \authorsSHORT~\articleYEAR}
\chead{\sf }
\rhead{\ifthenelse{\value{page}=1}{%
\begin{tikzpicture}[remember picture, overlay]
  \node [shift={(-3.5cm,-4cm)}] at (current page.north east) {
     \begin{tikzpicture}[remember picture, overlay]
       \fill [fill=darkred, opacity=1.0] (0,0) rectangle (2.cm,4cm);
       \node [shift={(1cm,1cm)}, opacity=1.0]
             {\includegraphics[width=1.5cm]{logo.pdf}};
     \end{tikzpicture}
  };
\end{tikzpicture}}{}}
\renewcommand{\footrulewidth}{0.0pt}
\lfoot{\sf \ReScience -- \today}
\cfoot{\sf }
\rfoot{
  \ifthenelse{\value{page}=1}
  {\sf \thepage}
  {\begin{tikzpicture}[remember picture, overlay]
      \node [shift={(-2.25cm,0cm)}] at (current page.south east) {
        \begin{tikzpicture}[remember picture, overlay]
          \fill [fill=darkred, opacity=1.0] (0,0) rectangle (0.75cm,1.50cm);
          \node [shift={(.375cm,1.1cm)}, color=white] {\sf \bfseries \thepage};
        \end{tikzpicture}
      };
    \end{tikzpicture}}
}



% =============================================================================
\bibliography{article.bib}

\begin{document}
\input{article-cover.tex}
\input{article-content.tex}
\addcontentsline{toc}{section}{References}
\renewcommand*{\bibfont}{\footnotesize \sffamily}
\printbibliography
\end{document}
% =============================================================================

